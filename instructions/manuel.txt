
## le serveur REST API
### Mise en place du REST API.
1. Installer node en suivant les instructions sur le site https://nodejs.org/en/
    la version 8 ou 10 est nécessaire.
2. Dans le dossier "api" du projet, ouvrir un terminal.
3. Dans le terminal, utiliser la commande "npm install" pour installer les dépendences
4. pour le fonctionnement du programme, la variable environnement "CASSANDRA_IP" doit contenir l'adresse ip de la BD cassandra (les détails de sa mise en place sont indiqué plus bas).
    4.1 Il est possible de configurer les variables environnement sur linux en démarrant le programme de la sorte "CASSANDRA_IP=X.X.X.X node bin/www"
    4.2 Dans un environnement window, il est possible d'écrire "set CASSANDRA_IP=X.X.X.X" avant de lancer le programme.
    4.3 Alternativement, il est possible d'inscrire la valeur de la variable d'environnement dans le fichier ".env", qui sera lu au démarrage du programme. les valeurs assigner directement au variable d'environnement ont priorité sur celle écrite dans le fichier ".env"
5. Dans le terminal, utiliser la commande "node bin/www" pour démarer le serveur contenant le REST API

### Détail de l'Api : 
- l'API suit la convention REST et le principe du HATEOAS (Hypermedia as the Engine of Application State).
pour l'utilisé, il suffit de faire une requête "GET" a la route de base de l'Api

- Chaque requête à l'API renvois du JSON aillant généralement deux attributs : "result" contient des données, et "__hypermedia" contient l'information sur la liste de route pouvant être accédé.

- Pour les requêtes longue, le REST Api suit une stratégie de création de ressource temporaire. Faire une requête demandant de long calcul impliquera donc de faire un "POST" pour créer une requête de calcul. ce message renverra un lien vers une ressource pour connaître l'état de la requête. lorsque la requête a fini d'être traité, cette route envoie en plus la route ou les résultat des calculs peuvent être accédé.
Le REST API garde pendant une durée limité le résultat des calculs fait a partir de tel requête. De plus, un nombre maximum de requête longue peut être exécuté en parallèle.
ette structure permet de garder les contraintes REST et d'exécuter des tâches complexes et potentiellement longue sans bloquer le client et le serveur.

- les factures sont envoyé et reçu par l'API sous la forme suivante :
{
    id : number,
    produits : [{
        nom : string,
        prix : number
    }]
}
lors d'une requête pour ajouté ou modifier une facture, c'est donc sous cette formes que doit être écris le JSON a envoyé

- Le système de modification utilise la méthode "PUT", mais ne permet pas, contrairement à la spécification original de la méthodes, d'insérer des ressources à l'adresse indiqué si ces éléments n'ont pas été créer grâce à la méthode POST auparavant.

- Le REST API ne supporte pas la méthode "PATCH". il n'est donc pas possible de modifier partiellement la liste de produits d'une facture. la modification utilise la méthode PUT et implique le renvoie de la liste complète tel qu'elle doit être enregistré.


## Le client.

### Mise en place du client.

1. Le client est un programme en ligne de commande écris en node. pour l'utiliser, il faut donc avoir Node 8 ou Node 10 installer. le site https://nodejs.org/en/ permet de téléchargé un installeur intéractif pour le système d'exploitation désiré.
2. Dans le dossier "client" du projet, ouvrir un terminal.
3. Dans le terminal, utiliser la commande "npm install" pour installer les dépendences.
4. Dans le terminal, utiliser la commande "node main.js --uri X.X.X.X:3000" pour démarrer le client. "X.X.X.X" représente l'adresse IPv4 du serveur contenant le REST API. Si ce dernier est sur la même machine que le client, ce sera donc localhost:3000.

à partir de là, un programme interactif en ligne de commande commencera permettant d'intéragir avec le REST API.

### détails du clients
- Le client est agnostique au contexte du REST API et utilise uniquement les informations contenus dans les hypermedias pour permettre l'exploration de l'API et la présentation des prochains choix.
- Lorsque le client demande des données pour envoyé au serveur (dans le cadre d'une requête aillant la méthode POST ou PUT, généralement), il s'attend à des données sous forme de JSON uniquement.
- Il est un problème connu que certain terminaux ont des problèmes d'encodages empéchant l'écriture correct de certain charactères accentués.


Base de donnée cassandra

Créer une machine virtuelle avec une image ubuntu 16.04

Installation de Cassandra:
	Pour pouvoir installer Cassandra, il faut installer java. Vous pouvez le faire avec les étapes suivantes:
		1- sudo add-apt-repository ppa:webupd8team/java
		2- sudo apt-get update
		3- sudo apt-get install oracle-java8-set-default
		4- java -version (pas nécessaire, juste pour vérifier que vous avez installer java)

	Par des problèmes d'avertissement, il est nécessaire ajouter trois clés afin que cassandra marche parfaitement:
		Pour commencer, vous pouvez chercher les repos suivantes afin d'avoir accès aux clés
			1- echo "deb http://www.apache.org/dist/cassandra/debian 22x main" | sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list
			2- echo "deb-src http://www.apache.org/dist/cassandra/debian 22x main" | sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list
	
		Voici les commandes à executer pour installer les clés:
			1- gpg --keyserver pgp.mit.edu --recv-keys F758CE318D77295D
			2- gpg --export --armor F758CE318D77295D | sudo apt-key add -
			3- gpg --keyserver pgp.mit.edu --recv-keys 2B5C1B00
			4- gpg --export --armor 2B5C1B00 | sudo apt-key add -
			5- gpg --keyserver pgp.mit.edu --recv-keys 0353B12C
			6- gpg --export --armor 0353B12C | sudo apt-key add -

	Après d'avoir les clés, updater les packages:
		1- sudo apt-get update

	Enfin, installez Cassandra:
		1- sudo apt-get install cassandra

Configuration de Cassandra:
	Pour rouler un noeud cassandra pavec l'addresse ip de la machine virtuelle, suivez les étapes suivantes:
		 1- Aller sur le terminal et allez à /etc/cassandra
		 2- Modifier le fichier cassandra.yaml avec sudo (sudo vim cassandra.yaml) et changez les paramètres suivants:
			*seed_provider:
				(...)
				parameters:
					-seeds: "127.0.0.1,<adresse ip de la vm>"
			
			*listen_address: <addresse ip de la vm>

			*start_rpc: true
			et commentez les parametres rpc_address et broadcast_rpc_address

Ouvrir Cassandra
	Pour commencer Cassandra, executer cette commande sur le terminale:
		- sudo service cassandra start
	
	Il est possible de verifier que le service est bien ouvert avec cette commande:
		- sudo nodetool status

	Pour acceder au noeud, executer cette commande:
		- cqlsh <addresse-ip de la vm>
	
	A partir de cette commande, vous pouvez faire toutes les requetes de cassandra directement sur ce noeud. Vous pouvez
quittez en tout temps avec la commande "exit"

	Pour fermer Cassandra, executer cette commande:
		- sudo service cassandra stop	

Spark

Installation et ajout de master à Spark
	1. Aller sur le site spark.org
	2. Télécharger spark-2.1.0-bin-hadoop2.4
	3. Après avoir installé Spark, aller dans le dossier "conf" du répertoire Spark
	4. Ouvrir un terminal et exécuter la commande "vi spark_env.sh"
	5. Ajouter les 4 lignes de codes suivant:
		SPARK_MASTER_HOST=127.0.0.1
		SPARK_LOCAL_IP=127.0.0.1
		SPARK_WORKER_INSTANCES=2
		SPARK_WORKER_CORES=1
	6. Sauvegarder le fichier et quitter
	7. Aller dans le dossier "sbin"
	8. Ensuite, exécuter la commande "./start-master.sh"
		Nous pouvons alors trouver notre master sur le port 8080, donc on peut tout simplement y avoir accès en entrant "localhost:8080"

Ajout des workers
	1. Copier le URL du master
	2. Exécuter la ligne suivante "./start-slave.sh " et ensuite coller le URL master que vous avez copié (par exemple: ./start-slave.sh spark://127.0.0.1:7077)
		Vous pouvez maintenant rafraîchir la page web du master et vous pouvez maintenant voir que les 2 workers sont présents

...
